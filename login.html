<html>
    <head>
        <meta charset="utf-8">
    </head>
<body>
    <nav class="include" include-html="./nav.html"></nav>
    <div class="section_login" style="margin-top:200px">
        <h3 class="tit_login">로그인</h3>
        <div class="write_form">
            <div class="write_view login_view">

                <input type="text" id='id_input' name="m_id" size="20" tabindex="1" value="" placeholder="아이디를 입력해주세요">
                <input type="password" id='password_input' name="password" size="20" tabindex="2"
                    placeholder="비밀번호를 입력해주세요">

                <button class="btn_type1"
                    onclick="login(document.getElementById('id_input').value, document.getElementById('password_input').value)"><span
                        class="txt_type">로그인</span></button>
                <!-- </form> -->

            </div>
        </div>
    </div>
    <script>



        function isLogin() {
            if (localStorage.getItem('token') == "") {
                window.location.href = 'login.html'
            }
        }
        isLogin();

        function login(id, password) {
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "https://5wzllwnu4k.execute-api.us-east-1.amazonaws.com/icu-login");
            
            xhr.setRequestHeader('Content-type', 'application/json');
            console.log(id)
            console.log(password)
            xhr.send(JSON.stringify({ userid: id, password: password }));


            xhr.onreadystatechange = function() {
                    if(xhr.status === 200) { // 201: Created
                        var obj = JSON.parse(xhr.responseText);
                        console.log(obj.token)
                        localStorage.setItem('token', obj.token)
                        console.log(obj.user.pk)
                        localStorage.setItem('user_pk',obj.user.pk)
                        window.location.href = "index.html";
                    } else {
                        console.log("Error!")
                }
            };
        }
    </script>

</body>

</html>